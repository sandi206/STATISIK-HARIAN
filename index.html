<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>STATISTIK HARIAN</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <header>
        <h1>DATA STATISTIK HARIAN</h1>
    </header>

    <div class="container">
        <form id="attendanceForm">
            <!-- Input Tanggal Penginputan -->
            <label for="inputDate">Tanggal Penginputan:</label>
            <input type="date" id="inputDate" name="inputDate" required>

            <!-- Input ID Karyawan -->
            <label for="employeeId">ID Karyawan:</label>
            <input type="text" id="employeeId" name="employeeId" placeholder="Masukkan ID Karyawan" required>

            <!-- PT Selection -->
            <label for="PT">PT</label>
            <select id="division" name="PT">
                <option value="PT A">CSP</option>
                <option value="PT B">LHMI</option>
                <option value="PT C">SMI</option>
            </select>

            <!-- Departemen Selection -->
            <label for="departemen">Departemen</label>
            <select id="departemen" name="Departemen">
                <option value="dept A">PERAWATAN 1</option>
                <option value="dept B">PERAWATAN 2</option>
                <option value="dept C">PERAWATAN 3</option>
                <option value="dept D">Lainnya</option>
            </select>

            <!-- Divisi Selection -->
            <label for="employeeDivision">Divisi:</label>
            <select id="employeeDivision" name="division">
                <option value="Divisi A">DESULFURISASI</option>
                <option value="Divisi B">ALAT</option>
                <option value="Divisi C">HSE</option>
                <option value="Divisi D">Lainnya</option>
            </select>

            <!-- Nama Regu -->
            <label for="team">Nama Regu:</label>
            <input type="text" id="team" name="team" placeholder="Masukkan Nama Regu dan Divisi jika tidak ada dalam list" required>

            <h3>Jenis Shift dan Absensi</h3>
            <table id="shiftTable">
                <thead>
                    <tr>
                        <th>Jenis Shift</th>
                        <th>Hadir</th>
                        <th>Absen Tunda</th>
                        <th>Sakit</th>
                        <th>Izin</th>
                        <th>CFV</th>
                        <th>CL</th>
                        <th>CT</th>
                        <th>OFF</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Example shift rows (you can add more as per your needs) -->
                    <tr>
                        <td>Shift Reguler</td>
                        <td><input type="number" name="shiftRegulerHadir" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerTunda" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerSakit" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerIzin" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerCFV" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerCL" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerCT" min="0" step="1"></td>
                        <td><input type="number" name="shiftRegulerOFF" min="0" step="1"></td>
                    </tr>
                    <!-- You can add more rows for other shifts -->
                </tbody>
            </table>

            <button type="submit" id="submitDataButton">Kirim Data</button>
        </form>

        <h2>Data Kehadiran</h2>
        <table id="attendanceTable">
            <thead>
                <tr>
                    <th>Tanggal Penginputan</th>
                    <th>ID Karyawan</th>
                    <th>PT</th>
                    <th>Departemen</th>
                    <th>Divisi</th>
                    <th>Nama Regu</th>
                    <th>Jenis Shift</th>
                    <th>Jumlah Absen</th>
                    <th>Jumlah Tunda</th>
                    <th>CFV</th>
                    <th>CL</th>
                    <th>CT</th>
                    <th>OFF</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button id="downloadButton" style="display: none;">Download Data Excel</button>
    </div>

    <script>
        // Function to handle form submission and create Excel file
        document.getElementById('attendanceForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent form from submitting traditionally

            const formData = new FormData(event.target);
            const data = {
                inputDate: formData.get('inputDate'),
                employeeId: formData.get('employeeId'),
                PT: formData.get('PT'),
                departemen: formData.get('Departemen'),
                division: formData.get('division'),
                team: formData.get('team'),
                shiftDetails: [],
            };

            // Collect shift data
            document.querySelectorAll('#shiftTable tbody tr').forEach(function(row) {
                const shiftType = row.cells[0].textContent;
                const shiftData = {
                    shiftType,
                    absen: row.querySelector('[name$="Hadir"]').value,
                    tunda: row.querySelector('[name$="Tunda"]').value,
                    sakit: row.querySelector('[name$="Sakit"]').value,
                    izin: row.querySelector('[name$="Izin"]').value,
                    cfv: row.querySelector('[name$="CFV"]').value,
                    cl: row.querySelector('[name$="CL"]').value,
                    ct: row.querySelector('[name$="CT"]').value,
                    off: row.querySelector('[name$="OFF"]').value
                };
                data.shiftDetails.push(shiftData);
            });

            // Append to the table (you can also add more formatting as needed)
            const tableBody = document.querySelector('#attendanceTable tbody');
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${data.inputDate}</td>
                <td>${data.employeeId}</td>
                <td>${data.PT}</td>
                <td>${data.departemen}</td>
                <td>${data.division}</td>
                <td>${data.team}</td>
                <td>${data.shiftDetails.map(shift => shift.shiftType).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.absen).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.tunda).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.cfv).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.cl).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.ct).join(', ')}</td>
                <td>${data.shiftDetails.map(shift => shift.off).join(', ')}</td>
            `;
            tableBody.appendChild(row);

            // Show the download button
            document.getElementById('downloadButton').style.display = 'inline-block';

            // Function to generate Excel file
            document.getElementById('downloadButton').addEventListener('click', function() {
                const table = document.getElementById('attendanceTable');
                const workbook = XLSX.utils.table_to_book(table, { sheet: "Data Kehadiran" });
                const wbout = XLSX.write(workbook, { bookType: 'xlsx', type: 'binary' });

                function s2ab(s) {
                    const buf = new ArrayBuffer(s.length);
                    const view = new Uint8Array(buf);
                    for (let i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
                    return buf;
                }

                const blob = new Blob([s2ab(wbout)], { type: "application/octet-stream" });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = 'data_kehadiran.xlsx';
                link.click();
            });
        });
    </script>
</body>
</html>
